#!/usr/bin/env python
import os
import time
import argparse

parser = argparse.ArgumentParser(description='Condor submit helper.')
parser.add_argument('--homework', type=int, default=3)
parser.add_argument('--stdout')
parser.add_argument('--stderr')
#parser.add_argument('args', nargs='+')
parser.add_argument('arguments')
opts = parser.parse_args()

job = '''
universe = vanilla
environment = CLASSPATH=/u/chbrown/nlp;PENN=/projects/nlp/penn-treebank3

InitialDir = /u/chbrown/nlp
Executable = /u/chbrown/nlp/target/start
Arguments = %s

+Group = "GRAD"
+Project = "INSTRUCTIONAL"
+ProjectDescription = "CS-388 Homework %d"

Notification = complete
Notify_user = chrisbrown@utexas.edu

''' % (opts.arguments, opts.homework)

if opts.stdout:
    job += 'Output = %s\n' % os.path.expanduser(opts.stdout)
if opts.stderr:
    job += 'Error = %s\n' % os.path.expanduser(opts.stderr)

job += 'Queue 1\n\n'

user_tmp = os.path.expanduser('~/tmp')
if not os.path.exists(user_tmp):
    os.makedirs(user_tmp)
job_path = os.path.join(user_tmp, '%s-%d.job' % (opts.arguments.split()[0], int(time.time())))
with open(job_path, 'w') as fp:
    fp.write(job)

print '>> submitting job written to %s' % job_path

os.system("ssh submit32.cs.utexas.edu '/lusr/opt/condor/bin/condor_submit %s'" % job_path)
